strata = "gender",
data = crisp_base_clean,
factorVars = catVars)
# Step 4: 导出为 data.frame
tab_df <- print(table1,
showAllLevels = TRUE,
quote = FALSE,
noSpaces = TRUE,
test = TRUE,
printToggle = FALSE) %>%
as.data.frame()
# Step 5: 安全地把行名转为一列（避免重复）
if ("level" %in% colnames(tab_df)) {
tab_df <- tibble::rownames_to_column(tab_df, var = "varname")
} else {
tab_df <- tibble::rownames_to_column(tab_df, var = "level")
}
# Step 6: 转 flextable
ft <- flextable(tab_df)
ft <- autofit(ft)
# Step 7: 导出到 Word
doc <- read_docx() %>%
body_add_par("Stratified by gender", style = "heading 1") %>%
body_add_flextable(ft)
print(doc, target = "Table1.docx")
getwd()
library(tableone)
library(dplyr)
library(officer)
library(flextable)
# Step 1: 选择变量
vars <- c("age", "race4", "educ", "ckd_epi", "tkv")
catVars <- c("race4", "educ")
# Step 2: 移除关键分类变量缺失值
crisp_base_clean <- crisp_base %>%
filter(!is.na(race4) & !is.na(educ) & !is.na(gender))
# Step 3: 创建 Table 1
table1 <- CreateTableOne(vars = vars,
strata = "gender",
data = crisp_base_clean,
factorVars = catVars)
# Step 4: 导出为 data.frame
tab_df <- print(table1,
showAllLevels = TRUE,
quote = FALSE,
noSpaces = TRUE,
test = TRUE,
printToggle = FALSE) %>%
as.data.frame()
# Step 5: 安全地把行名转为一列（避免重复）
if ("level" %in% colnames(tab_df)) {
tab_df <- tibble::rownames_to_column(tab_df, var = "varname")
} else {
tab_df <- tibble::rownames_to_column(tab_df, var = "level")
}
# Step 6: 转 flextable
ft <- flextable(tab_df)
ft <- autofit(ft)
# Step 7: 导出到 Word
doc <- read_docx() %>%
body_add_par("Stratified by gender", style = "heading 1") %>%
body_add_flextable(ft)
print(doc, target = "Table1.docx")
getwd()
library(flextable)
library(dplyr)
# 创建正确格式化的数据
table_data <- data.frame(
Characteristic = c(
"n",
"Age, years",
"Race",
"  White",
"  Black",
"  Hispanic",
"  Other",
"Education, years",
"  Less than high school (7-11)",
"  High school graduate (12)",
"  Some college (13-15)",
"  College graduate (16+)",
"CKD-EPI eGFR, mL/min/1.73m²",
"Total Kidney Volume, mL"
),
Male = c(
"93",
"31.86 (8.85)",
"",
"85 (91.4)",
"7 (7.5)",
"0 (0.0)",
"1 (1.1)",
"",
"9 (9.7)",
"25 (26.9)",
"17 (18.3)",
"42 (45.2)",
"96.08 (23.01)",
"1108.93 (679.48)"
),
Female = c(
"129",
"31.70 (9.01)",
"",
"106 (82.2)",
"20 (15.5)",
"2 (1.6)",
"1 (0.8)",
"",
"17 (13.2)",
"24 (18.6)",
"34 (26.4)",
"54 (41.9)",
"95.46 (19.81)",
"908.08 (511.38)"
),
P_Value = c(
"",
"0.891",
"0.182",
"", "", "", "",
"0.391",
"", "", "", "",
"0.830",
"0.013"
)
)
# 创建专业表格
ft <- table_data %>%
flextable() %>%
set_caption("Table 1. Baseline Characteristics of Study Participants by Gender in the CRISP Kidney Study") %>%
set_header_labels(
Characteristic = "Characteristic",
Male = "Male (n=93)",
Female = "Female (n=129)",
P_Value = "P-value"
) %>%
bold(part = "header") %>%
bold(i = ~ !grepl("^  ", Characteristic)) %>%
align(align = "center", part = "header") %>%
align(align = "left", j = 1) %>%
align(align = "center", j = 2:4) %>%
padding(j = 1, i = ~ grepl("^  ", Characteristic), padding.left = 20) %>%
width(width = c(2.2, 1.5, 1.5, 0.8)) %>%
fontsize(size = 10, part = "all") %>%
border_outer() %>%
border_inner_h() %>%
# 添加脚注
add_footer_lines(values = c(
"Abbreviations: CKD-EPI, Chronic Kidney Disease Epidemiology Collaboration; eGFR, estimated Glomerular Filtration Rate.",
"Notes: Data are presented as Mean (Standard Deviation) for continuous variables and n (%) for categorical variables.",
"P-values were derived from two-sample t-test for continuous variables and Chi-squared test for categorical variables.",
"Education categories were grouped for clarity: Less than high school (7-11 years), High school (12 years), Some college (13-15 years), College graduate (16+ years).",
"Significant difference observed in Total Kidney Volume between males and females (p=0.013)."
)) %>%
fontsize(part = "footer", size = 8) %>%
color(part = "footer", color = "gray40")
# 在R中预览表格
print(ft, preview = "docx")
# 保存为Word文档
save_as_docx(ft, path = "Table1_CRISP_Study_Corrected.docx")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(knitr)
library(ggplot2)
# Replace the path with your dataset location after download
data <- read_csv("D:/下载/Mental_Health_Lifestyle_Dataset.csv")
# Check structure
glimpse(data)
summary_table <- data %>%
select(Sleep_Hours, Physical_Activity, Depression, Anxiety, Stress) %>%
summary()
library(knitr)
# 数值型变量的描述性统计
num_summary <- data %>%
summarise(
Mean_Age = mean(Age, na.rm = TRUE),
SD_Age   = sd(Age, na.rm = TRUE),
Mean_Sleep = mean(`Sleep Hours`, na.rm = TRUE),
SD_Sleep   = sd(`Sleep Hours`, na.rm = TRUE),
Mean_WorkHrs = mean(`Work Hours per Week`, na.rm = TRUE),
SD_WorkHrs   = sd(`Work Hours per Week`, na.rm = TRUE)
)
# 分类变量的分布
stress_dist <- data %>%
count(`Stress Level`) %>%
mutate(Percent = round(n / sum(n) * 100, 1))
mental_dist <- data %>%
count(`Mental Health Condition`) %>%
mutate(Percent = round(n / sum(n) * 100, 1))
# 输出表格
kable(num_summary, caption = "Summary statistics of numerical variables")
kable(stress_dist, caption = "Distribution of Stress Levels")
kable(mental_dist, caption = "Distribution of Reported Mental Health Conditions")
library(knitr)
# Summary statistics for numeric variables
num_summary <- data %>%
summarise(
Mean_Age = mean(Age, na.rm = TRUE),
SD_Age   = sd(Age, na.rm = TRUE),
Mean_Sleep = mean(`Sleep Hours`, na.rm = TRUE),
SD_Sleep   = sd(`Sleep Hours`, na.rm = TRUE),
Mean_WorkHrs = mean(`Work Hours per Week`, na.rm = TRUE),
SD_WorkHrs   = sd(`Work Hours per Week`, na.rm = TRUE)
)
# Distribution of stress levels
stress_dist <- data %>%
count(`Stress Level`) %>%
mutate(Percent = round(n / sum(n) * 100, 1))
# Distribution of reported mental health conditions
mental_dist <- data %>%
count(`Mental Health Condition`) %>%
mutate(Percent = round(n / sum(n) * 100, 1))
# Display formatted tables
kable(num_summary, caption = "Summary statistics of numerical variables")
kable(stress_dist, caption = "Distribution of Stress Levels")
kable(mental_dist, caption = "Distribution of Reported Mental Health Conditions")
# Load required package
library(ggplot2)
# 1. Gender distribution (Bar plot)
ggplot(data, aes(x = Gender, fill = Gender)) +
geom_bar() +
labs(title = "Gender Distribution",
x = "Gender",
y = "Count") +
theme_minimal()
# 2. Age distribution (Histogram)
ggplot(data, aes(x = Age)) +
geom_histogram(binwidth = 5, fill = "steelblue", color = "white", alpha = 0.7) +
labs(title = "Age Distribution",
x = "Age",
y = "Frequency") +
theme_minimal()
# 3. Occupation distribution (Bar plot, ordered by frequency)
ggplot(data, aes(x = Occupation)) +
geom_bar(fill = "tomato", alpha = 0.8) +
labs(title = "Occupation Distribution",
x = "Occupation",
y = "Count") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
library(knitr)
# Summary statistics for numeric variables
num_summary <- data %>%
summarise(
Mean_Age = mean(Age, na.rm = TRUE),
SD_Age   = sd(Age, na.rm = TRUE),
Mean_Sleep = mean(`Sleep Hours`, na.rm = TRUE),
SD_Sleep   = sd(`Sleep Hours`, na.rm = TRUE),
Mean_WorkHrs = mean(`Work Hours per Week`, na.rm = TRUE),
SD_WorkHrs   = sd(`Work Hours per Week`, na.rm = TRUE)
)
# Distribution of stress levels
stress_dist <- data %>%
count(`Stress Level`) %>%
mutate(Percent = round(n / sum(n) * 100, 1))
# Distribution of reported mental health conditions
mental_dist <- data %>%
count(`Mental Health Condition`) %>%
mutate(Percent = round(n / sum(n) * 100, 1))
# Display formatted tables
kable(num_summary, caption = "Summary statistics of numerical variables")
kable(stress_dist, caption = "Distribution of Stress Levels")
kable(mental_dist, caption = "Distribution of Reported Mental Health Conditions")
ggplot(data, aes(x = Gender)) +
geom_bar(fill = "tomato", alpha = 0.8) +
labs(title = "Gender Distribution",
x = "Gender",
y = "Count") +
theme_minimal()
# Load required package
library(ggplot2)
# 1. Gender distribution (Bar plot)
ggplot(data, aes(x = Gender, fill = Gender)) +
geom_bar() +
labs(title = "Gender Distribution",
x = "Gender",
y = "Count") +
theme_minimal()
# 2. Age distribution (Histogram)
ggplot(data, aes(x = Age)) +
geom_histogram(binwidth = 5, fill = "steelblue", color = "white", alpha = 0.7) +
labs(title = "Age Distribution",
x = "Age",
y = "Frequency") +
theme_minimal()
# 3. Occupation distribution (Bar plot, ordered by frequency)
ggplot(data, aes(x = Occupation)) +
geom_bar(fill = "tomato", alpha = 0.8) +
labs(title = "Occupation Distribution",
x = "Occupation",
y = "Count") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Load required package
library(ggplot2)
# 1. Gender distribution (Bar plot)
ggplot(data, aes(x = Gender, fill = Gender)) +
geom_bar() +
labs(title = "Gender Distribution",
x = "Gender",
y = "Count") +
theme_minimal()
# 2. Age distribution (Histogram)
ggplot(data, aes(x = Age)) +
geom_histogram(binwidth = 5, fill = "steelblue", color = "white", alpha = 0.7) +
labs(title = "Age Distribution",
x = "Age",
y = "Frequency") +
theme_minimal()
# 3. Occupation distribution (Bar plot, ordered by frequency)
ggplot(data, aes(x = `Diet Type`)) +
geom_bar(fill = "skyblue", alpha = 0.8) +
labs(title = "Diet Type Distribution",
x = "Diet Type",
y = "Count") +
theme_minimal()
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(knitr)
library(ggplot2)
ggplot(data, aes(x = Gender, fill = Gender)) +
geom_bar() +
labs(title = "Gender Distribution", x = "Gender", y = "Count") +
theme_minimal()}
# Package
library(ggplot2)
# 1. Gender distribution (Bar plot)
ggplot(data, aes(x = Gender, fill = Gender)) +
geom_bar() +
labs(title = "Gender Distribution",
x = "Gender",
y = "Count") +
theme_minimal()
# 2. Age distribution (Histogram)
ggplot(data, aes(x = Age)) +
geom_histogram(binwidth = 5, fill = "steelblue", color = "white", alpha = 0.7) +
labs(title = "Age Distribution",
x = "Age",
y = "Frequency") +
theme_minimal()
# 3. Occupation distribution (Bar plot, ordered by frequency)
ggplot(data, aes(x = `Diet Type`)) +
geom_bar(fill = "skyblue", alpha = 0.8) +
labs(title = "Diet Type Distribution",
x = "Diet Type",
y = "Count") +
theme_minimal()
# 3. Occupation distribution (Bar plot, ordered by frequency)
ggplot(data, aes(x = `Diet Type`)) +
geom_bar(fill = "skyblue", alpha = 0.8) +
labs(title = "Diet Type Distribution",
x = "Diet Type",
y = "Count") +
theme_minimal()
# 2. Age distribution (Histogram)
ggplot(data, aes(x = Age)) +
geom_histogram(binwidth = 5, fill = "steelblue", color = "white", alpha = 0.7) +
labs(title = "Age Distribution",
x = "Age",
y = "Frequency") +
theme_minimal()
install.packages("renv")
# 1. Packages
library(yaml)     # 用于读取 config.yml
library(tidyverse)
# 1. Packages
library(yaml)     # 用于读取 config.yml
library(tidyverse)
# 2. 读取配置和数据
config <- read_yaml("config.yml")
# 1. Load necessary libraries
library(tidyverse) # Includes ggplot2 and dplyr
library(here)
library(yaml)     # For reading config.yml
# 2. Read configuration and data
# Ensure config.yml exists and contains the 'team' field
config <- read_yaml(here("config.yml"))
# 2. Read configuration and data
# Ensure config.yml exists and contains the 'team' field
config <- read_yaml(here("D:\D550_Midterm\config.yml"))
# 2. Read configuration and data
# Ensure config.yml exists and contains the 'team' field
config <- read_yaml(here("D:/D550_Midterm/config.yml"))
team_filter <- config$team
# Read cleaned data (generated by Coder 5)
data_cleaned <- readRDS(here("results", "01_dataclean.Rds"))
# Read cleaned data (generated by Coder 5)
data_cleaned <- readRDS(here("D:/D550_Midterm/results", "D:/D550_Midterm/01_dataclean.Rds"))
setwd("D:/D550_Midterm")
config <- read_yaml(here("D:/D550_Midterm/config.yml"))
team_filter <- config$team
config <- read_yaml(here("config.yml"))
setwd("D:/D550_Midterm")
config <- read_yaml(here("config.yml"))
setwd("D:/D550_Midterm")
config <- read_yaml(here("config.yml"))
setwd("D:/D550_Midterm")
getwd()
# 1. Load necessary libraries
library(tidyverse) # Includes ggplot2 and dplyr
library(here)
library(yaml)     # For reading config.yml
# 2. Read configuration and data
# Ensure config.yml exists and contains the 'team' field
config <- read_yaml(here("config.yml"))
> setwd("D:/D550_Midterm")
setwd("D:/D550_Midterm")
# 1. Load necessary libraries
library(tidyverse) # Includes ggplot2 and dplyr
library(here)
library(yaml)     # For reading config.yml
# 2. Read configuration and data
# Ensure config.yml exists and contains the 'team' field
config <- read_yaml(here("config.yml"))
here::i_am("config.yml")
config <- read_yaml(here("config.yml"))
team_filter <- config$team
# 1. Load necessary libraries
library(tidyverse) # Includes ggplot2 and dplyr
library(here)
library(yaml)     # For reading config.yml
# 2. Read configuration and data
# Ensure config.yml exists and contains the 'team' field
here::i_am("config.yml")
config <- read_yaml(here("config.yml"))
team_filter <- config$team
# 1. Load necessary libraries
library(tidyverse) # Includes ggplot2 and dplyr
library(here)
library(yaml)     # For reading config.yml
# 2. Read configuration and data
# Ensure config.yml exists and contains the 'team' field
here::i_am("config.yml")
config <- read_yaml(here("config.yml"))
team_filter <- config$team
# Read cleaned data (generated by Coder 5)
data_cleaned <- readRDS(here("results", "01_dataclean.Rds"))
# 3. Apply customization filter (Team filtering logic: ALL or specific team)
if (team_filter != "ALL") {
# Ensure Team variable is character type
data_filtered <- data_cleaned %>%
mutate(Team = as.character(Team)) %>%
filter(Team == team_filter)
message(paste("Filtering data for team:", team_filter, ". N =", nrow(data_filtered)))
} else {
data_filtered <- data_cleaned
message("Using full dataset (ALL teams). N = ", nrow(data_filtered))
}
# Output director
dir.create(here("results", "03_results"), recursive = TRUE, showWarnings = FALSE)
# 4. Generate REQUIRED FIGURES
# (A) Histogram: Distribution of PTS (results/03_results/hist_pts.png)
hist_pts <- ggplot(data_filtered, aes(x = PTS)) +
geom_histogram(binwidth = 1, fill = "skyblue", color = "black") +
labs(title = paste("Distribution of Points Per 36 Minutes", ifelse(team_filter != "ALL", paste0(" (", team_filter, ")"), "")),
x = "Points Per 36 Minutes (PTS)",
y = "Number of Players") +
theme_minimal(base_size = 14)
ggsave(here("results", "03_results", "hist_pts.png"), hist_pts, width = 8, height = 5)
# (B) Boxplot: Comparison of PTS by position (Pos) (results/03_results/box_pts_position.png)
# Simplify position labels to Guard, Forward, Center for comparison
box_data <- data_filtered %>%
mutate(
Position_Simple = str_extract(Pos, "[A-Z]"),
Position_Category = case_when(
Position_Simple == "G" ~ "Guard",
Position_Simple == "F" ~ "Forward",
Position_Simple == "C" ~ "Center",
TRUE ~ "Other" # Exclude unclassified positions
)
) %>%
filter(Position_Category != "Other")
box_pts_position <- ggplot(box_data, aes(x = Position_Category, y = PTS, fill = Position_Category)) +
geom_boxplot(alpha = 0.7) +
labs(title = paste("PTS Distribution by Player Position", ifelse(team_filter != "ALL", paste0(" (", team_filter, ")"), "")),
x = "Position",
y = "Points Per 36 Minutes (PTS)") +
theme_minimal(base_size = 14) +
theme(legend.position = "none")
ggsave(here("results", "03_results", "box_pts_position.png"), box_pts_position, width = 8, height = 5)
# (C) Bar chart: Top 10 players by PTS (results/03_results/top10_pts_bar.png)
# Note: If the filtered team has fewer than 10 players, it displays all of them
top_players <- data_filtered %>%
arrange(desc(PTS)) %>%
slice_head(n = 10) %>%
# Create labels for the chart
mutate(Player_Team = paste0(Player, " (", Team, ")"),
Player_Team = fct_reorder(Player_Team, PTS))
bar_top10 <- ggplot(top_players, aes(x = Player_Team, y = PTS, fill = Team)) +
geom_col() +
coord_flip() + # Flip coordinates for better readability
labs(title = paste("Top", nrow(top_players), ifelse(team_filter != "ALL", paste0(" ", team_filter, " Players by PTS"), " NBA Players by PTS")),
subtitle = "Based on per-36 minute statistics",
x = "Player (Team)",
y = "Points Per 36 Minutes (PTS)") +
theme_minimal(base_size = 14) +
# Hide legend if ALL teams are shown
{if (team_filter == "ALL") theme(legend.position = "none")}
ggsave(here("results", "03_results", "top10_pts_bar.png"), bar_top10, width = 8, height = 6)
# (D) Scatterplot: MP vs PTS, colored by Team (results/03_results/scatter_mp_pts.png)
scatter_mp_pts <- ggplot(data_filtered, aes(x = MP, y = PTS, color = Team)) +
geom_point(alpha = 0.6) +
geom_smooth(method = "lm", se = FALSE, color = "darkred", linetype = "dashed") + # Add trendline
labs(title = paste("Minutes Played vs. Points Per 36 Minutes", ifelse(team_filter != "ALL", paste0(" (", team_filter, ")"), "")),
x = "Minutes Played Per 36 Minutes (MP)",
y = "Points Per 36 Minutes (PTS)",
color = "Team") +
theme_minimal(base_size = 14) +
# Hide legend if ALL teams are shown to avoid clutter
{if (team_filter == "ALL") theme(legend.position = "none")}
ggsave(here("results", "03_results", "scatter_mp_pts.png"), scatter_mp_pts, width = 8, height = 6)
